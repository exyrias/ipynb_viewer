<!DOCTYPE html>
<html>

<head>
  <title>ipynb Viewer</title>
</head>

<body>
  <input type="file" id="inputfile" />
  <div id="imgarea"></div>
  <script>
    let inputFile = document.getElementById('inputfile');
    let div = document.getElementById('imgarea');
    inputFile.addEventListener('change', (e) => {
      // reset div
      while (div.firstChild) {
        div.removeChild(div.firstChild);
      }

      let reader = new FileReader();
      reader.readAsText(e.target.files[0]);

      reader.onload = () => {
        let cells = JSON.parse(reader.result).cells;

        cells.forEach(cell => {
          let elm_source = document.createElement("pre");
          elm_source.className = "source";
          elm_source.innerHTML = cell.source.join("");
          elm_source.style.backgroundColor = "rgb(224,224,224)"; // '#xxxxxx' style does not work in bookmarklet
          elm_source.style.padding = "3pt";
          elm_source.style.margin = "5pt";

          let elm_outputs = document.createElement("div");
          elm_outputs.className = "outputs";
          cell.outputs.forEach(dat => {
            if (dat.output_type === "stream") {
              let elm_output_text = document.createElement("pre");
              elm_output_text.className = "outputtext";
              elm_output_text.innerHTML = dat.text.join("");
              elm_output_text.style.backgroundColor = "rgb(248,248,248)"; // '#xxxxxx' style does not work in bookmarklet
              elm_output_text.style.padding = "3pt";
              elm_output_text.style.margin = "5pt";
              elm_outputs.appendChild(elm_output_text);
            }
            else if(dat.output_type === "display_data"){
              let elm_small_btn = document.createElement("button");
              let elm_big_btn = document.createElement("button");
              elm_small_btn.innerHTML = "-";
              elm_big_btn.innerHTML = "+";
              elm_outputs.appendChild(elm_small_btn);
              elm_outputs.appendChild(elm_big_btn);
              elm_outputs.appendChild(document.createElement("br"));

              let elm_output_img = document.createElement("img");
              let src="data:image/png;base64,";
              src += dat.data["image/png"];
              elm_output_img.src = src;
              elm_outputs.appendChild(elm_output_img);

              elm_small_btn.addEventListener('click', () => {
                let scale = elm_output_img.width / elm_output_img.naturalWidth;
                scale = scale < 0.1 ? scale : scale - 0.1;
                elm_output_img.width = scale * elm_output_img.naturalWidth;
                elm_output_img.height = scale * elm_output_img.naturalHeight;
              });
              elm_big_btn.addEventListener('click', () => {
                let scale = elm_output_img.width / elm_output_img.naturalWidth;
                scale = scale > 10 ? scale : scale + 0.1;
                elm_output_img.width = scale * elm_output_img.naturalWidth;
                elm_output_img.height = scale * elm_output_img.naturalHeight;
              });
            }
            else if(dat.output_type == "execute_result"){
              let elm_output_html = document.createElement("div");
              elm_output_html.className = "outputexecrslt";
              elm_output_html.innerHTML = dat.data['text/html'].join(""); // plain text
              //elm_output_html.style.backgroundColor = "rgb(248,248,248)"; // '#xxxxxx' style does not work in bookmarklet
              //elm_output_html.style.padding = "3pt";
              //elm_output_html.style.margin = "5pt";
              elm_outputs.appendChild(elm_output_html);
            }
          });

          let elm_cell = document.createElement("div");
          elm_cell.className = "cell";
          elm_cell.appendChild(elm_source);
          elm_cell.appendChild(elm_outputs);

          div.appendChild(elm_cell);
        });
      };
    }, false);
  </script>
</body>

</html>
